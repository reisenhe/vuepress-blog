---
title: 【JavaScript】知识小记 - 发布订阅模式
date: 2021-01-07
categories:
 - frontEnd
author: ReisenD
tags:
 - javascript
 - 设计模式
 - 面试
---

发布订阅，是一种计算机语音开发模式。它定义一种对象之间的一对多的关系，当一个被观察的对象发生变化时，观察者将接收到消息。
:::tip
发布订阅模式 与 观察者模式 之间的区别在于，发布者和订阅者不直接交流，而是通过一层消息代理进行通信
:::

```js
class EventEmitter {
    constructor() {
        this.list = {}
    }
    // 绑定事件
    on(key, fn) {
        // 因为一个事件可能要触发多个方法，所以以数组形式存储该事件的方法
        if (!this.list[key]) {
            this.list[key] = []
        }
        this.list[key].push(fn)
        return this
    }
    // 触发事件
    emit(key, ...args) {
        let fns = this.list[key]
        if (!fns || !fns.length) return false;
        // 事件存在方法，遍历执行该方法
        for (let i = 0; i < fns.length; i++) {
            fns[i].call(this, ...args)
        }
    }
    // 只监听一次，触发后就去除该方法
    once (key, fn) {
        let _this = this;
        let onFn = function (...args) {
            // 将消除方法的事件也置于执行该方法中
            _this.off(key, onFn);
            fn.call(_this, ...args)
        }
        this.on(key, onFn)
    }
    // 取消事件里的某个方法
    off(key, fn) {
        let fns = this.list[key]
        this.list[key] = fns.filter(item => item.name !== fn.name)
    }
    // 取消整个事件
    alloff(key) {
        if (key === undefined) {
            this.list = {}
        } else {
            this.list[key] = []
        }
    }
}

let EvEm = new EventEmitter()
let quin = (time) => {console.log(`才${time}, 摸了`)}
EvEm.on('rua', quin)
EvEm.emit('rua', '八点')        // 才八点, 摸了
```